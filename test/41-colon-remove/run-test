#! /bin/sh

[ "${TRACE}" = 'YES' ] && set -x && : "$0" "$@"

###   ###   ###   ###   ###   ###   ###   ###   ###   ###   ###   ###   ###
MULLE_BASHFUNCTIONS_LIBEXEC_DIR="${MULLE_BASHFUNCTIONS_LIBEXEC_DIR:-`mulle-bashfunctions libexec-dir`}" || exit 1

. "${MULLE_BASHFUNCTIONS_LIBEXEC_DIR}/mulle-boot.sh"          || exit 1
. "${MULLE_BASHFUNCTIONS_LIBEXEC_DIR}/mulle-bashglobal.sh"    || exit 1
. "${MULLE_BASHFUNCTIONS_LIBEXEC_DIR}/mulle-compatibility.sh" || exit 1
. "${MULLE_BASHFUNCTIONS_LIBEXEC_DIR}/mulle-logging.sh"       || exit 1
. "${MULLE_BASHFUNCTIONS_LIBEXEC_DIR}/mulle-options.sh"       || exit 1
. "${MULLE_BASHFUNCTIONS_LIBEXEC_DIR}/mulle-string.sh"        || exit 1
. "${MULLE_BASHFUNCTIONS_LIBEXEC_DIR}/mulle-path.sh"          || exit 1
. "${MULLE_BASHFUNCTIONS_LIBEXEC_DIR}/mulle-exekutor.sh"      || exit 1
. "${MULLE_BASHFUNCTIONS_LIBEXEC_DIR}/mulle-file.sh"          || exit 1
###   ###   ###   ###   ###   ###   ###   ###   ###   ###   ###   ###   ###

if [ ${ZSH_VERSION+x} ]
then
   setopt sh_word_split
fi


expect_output()
{
   local output="$1"
   local expected="$2"

   if [ "${output}" != "${expected}" ]
   then
      echo "Got \"${output}\". Expected: \"${expected}\"" >&2
      stacktrace >&2
      exit 1
   fi
}


test_colon_remove()
{
# EMPTY LIST
   r_colon_remove "" "item"
   expect_output "${RVAL}" ""

# SINGLE ITEM - REMOVE IT
   r_colon_remove "item" "item"
   expect_output "${RVAL}" ""

# SINGLE ITEM - REMOVE NON-EXISTENT
   r_colon_remove "item" "other"
   expect_output "${RVAL}" "item"

# TWO ITEMS - REMOVE FIRST
   r_colon_remove "first:second" "first"
   expect_output "${RVAL}" "second"

# TWO ITEMS - REMOVE SECOND
   r_colon_remove "first:second" "second"
   expect_output "${RVAL}" "first"

# THREE ITEMS - REMOVE MIDDLE
   r_colon_remove "first:middle:last" "middle"
   expect_output "${RVAL}" "first:last"

# UTF-8 STRINGS - GERMAN
   r_colon_remove "Ã¤pfel:birnen:kirschen" "birnen"
   expect_output "${RVAL}" "Ã¤pfel:kirschen"

# UTF-8 STRINGS - JAPANESE
   r_colon_remove "ã‚Šã‚“ã”:ãƒãƒŠãƒŠ:ã‚ªãƒ¬ãƒ³ã‚¸" "ãƒãƒŠãƒŠ"
   expect_output "${RVAL}" "ã‚Šã‚“ã”:ã‚ªãƒ¬ãƒ³ã‚¸"

# UTF-8 STRINGS - EMOJI
   r_colon_remove "ğŸ:ğŸŒ:ğŸŠ" "ğŸŒ"
   expect_output "${RVAL}" "ğŸ:ğŸŠ"

# UTF-8 STRINGS - CYRILLIC
   r_colon_remove "ÑĞ±Ğ»Ğ¾ĞºĞ¾:Ğ±Ğ°Ğ½Ğ°Ğ½:Ğ°Ğ¿ĞµĞ»ÑŒÑĞ¸Ğ½" "Ğ±Ğ°Ğ½Ğ°Ğ½"
   expect_output "${RVAL}" "ÑĞ±Ğ»Ğ¾ĞºĞ¾:Ğ°Ğ¿ĞµĞ»ÑŒÑĞ¸Ğ½"

# UTF-8 STRINGS - MIXED
   r_colon_remove "apple:Ã¤pfel:ã‚Šã‚“ã”:ğŸ" "Ã¤pfel"
   expect_output "${RVAL}" "apple:ã‚Šã‚“ã”:ğŸ"
}


main()
{
   test_colon_remove

   echo "All tests passed" >&2
}


main "$@"
